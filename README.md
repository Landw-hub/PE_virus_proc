# 32位PE病毒传播实验

## 实验说明

下面是实验的测试说明：

1. 32位方式编译 `test.c` 和 `test2.c` 文件：

    ```bash
    gcc -m32 test.c -o test
    ```

    这两个文件的作用很简单，用于生成宿主程序并打印字符串。

2. 修改 `shellcode.c` 中的路径为自己的储存路径（参考代码注释），编译 `shellcode.c` 生成 `shellcode.exe`：

    ```bash
    gcc -m32 -fno-stack-protector shellcode.c -o shellcode
    ```

    请注意禁用安全选项。

3. 用 PE bear 打开 `shellcode.exe`，提取其中的 `.virus` 代码段并以默认的名称保存，得到病毒载荷。

4. 修改 `infect.cpp` 中的路径为自己的储存路径（参考代码注释），运行 `infect.cpp`，目的是将刚刚提取出的病毒载荷插入 `test.exe` 中。

5. 注意观察初始状态下的 `1.txt` 和 `2.txt` 中有内容，而 `2021302181168.txt` 没有内容。`test.exe` 被插入病毒载荷后，会执行以下功能：
    - 打印字符串（原本）
    - 在同目录下查找除 `2021302181168.txt` 外的 `txt` 文件，并将其内容复制到 `2021302181168.txt` 中
    - 将第二步的功能传染给同目录的所有 `exe` 文件

6. 运行 `test.exe`，查看 `2021302181168.txt` 发现有内容，表明第 5 步中的第二项功能成功。删除其中的内容再运行 `test2.exe`，查看 `2021302181168.txt` 发现又有内容，表明第 5 步中的第三项功能成功。

## 注意事项

1. 目标程序（未传染版）需在目标程序文件夹中。`shellcode.c` 和 `infect.cpp` 需要修改路径方可编译，因此这里不提供 `shellcode` 和 `infect` 的可执行程序。

2. 如果无法达到上述的测试环境，可以观看 `PE病毒演示.mp4`。如对实验代码有异议，可联系组长QQ: 2362705409。
